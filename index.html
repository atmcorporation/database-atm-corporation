<?php
session_start();

// Koneksi ke database
$host = 'localhost';
$username = 'root';
$password = '';
$dbname = 'pt_harapan_utama_prima';

$conn = new mysqli($host, $username, $password, $dbname);
if ($conn->connect_error) {
    die("Koneksi gagal: " . $conn->connect_error);
}

// Fungsi untuk menangani login
function login($email, $password) {
    global $conn;
    $stmt = $conn->prepare("SELECT * FROM users WHERE email = ? AND password = ?");
    $stmt->bind_param('ss', $email, $password);
    $stmt->execute();
    $result = $stmt->get_result();
    if ($result->num_rows > 0) {
        $_SESSION['user'] = $email;
        return true;
    }
    return false;
}

// Fungsi untuk menangani registrasi
function register($email, $password) {
    global $conn;
    $stmt = $conn->prepare("INSERT INTO users (email, password) VALUES (?, ?)");
    $stmt->bind_param('ss', $email, $password);
    return $stmt->execute();
}

// Fungsi untuk menambah karyawan
function addEmployee($data) {
    global $conn;
    $stmt = $conn->prepare("INSERT INTO employees (name, nik, position, service_manager, region, cluster, phone, email, ktp, license_status) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");
    $stmt->bind_param('ssssssssss', $data['name'], $data['nik'], $data['position'], $data['service_manager'], $data['region'], $data['cluster'], $data['phone'], $data['email'], $data['ktp'], $data['license_status']);
    return $stmt->execute();
}

// Fungsi untuk mengedit karyawan
function editEmployee($id, $data) {
    global $conn;
    $stmt = $conn->prepare("UPDATE employees SET name = ?, nik = ?, position = ?, service_manager = ?, region = ?, cluster = ?, phone = ?, email = ?, ktp = ?, license_status = ? WHERE id = ?");
    $stmt->bind_param('ssssssssssi', $data['name'], $data['nik'], $data['position'], $data['service_manager'], $data['region'], $data['cluster'], $data['phone'], $data['email'], $data['ktp'], $data['license_status'], $id);
    return $stmt->execute();
}

// Fungsi untuk menghapus karyawan
function deleteEmployee($id) {
    global $conn;
    $stmt = $conn->prepare("DELETE FROM employees WHERE id = ?");
    $stmt->bind_param('i', $id);
    return $stmt->execute();
}

// Fungsi untuk mengimpor data karyawan dari file Excel
function importEmployees($file) {
    // Implementasi impor data dari file Excel
    // ...
}

// Fungsi untuk mengekspor data karyawan ke file Excel
function exportEmployees() {
    // Implementasi ekspor data ke file Excel
    // ...
}

// Menangani aksi login
if (isset($_POST['login'])) {
    $email = $_POST['email'];
    $password = $_POST['password'];
    if (login($email, $password)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Email atau kata sandi salah!';
    }
}

// Menangani aksi registrasi
if (isset($_POST['register'])) {
    $email = $_POST['email'];
    $password = $_POST['password'];
    if (register($email, $password)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Registrasi gagal!';
    }
}

// Menangani aksi tambah karyawan
if (isset($_POST['add_employee'])) {
    $data = $_POST;
    if (addEmployee($data)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Gagal menambah karyawan!';
    }
}

// Menangani aksi edit karyawan
if (isset($_POST['edit_employee'])) {
    $id = $_POST['id'];
    $data = $_POST;
    if (editEmployee($id, $data)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Gagal mengedit karyawan!';
    }
}

// Menangani aksi hapus karyawan
if (isset($_GET['delete'])) {
    $id = $_GET['delete'];
    if (deleteEmployee($id)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Gagal menghapus karyawan!';
    }
}

// Menangani aksi impor data
if (isset($_POST['import'])) {
    $file = $_FILES['file'];
    if (importEmployees($file)) {
        header('Location: index.php');
        exit();
    } else {
        $error = 'Gagal mengimpor data!';
    }
}

// Menangani aksi ekspor data
if (isset($_POST['export'])) {
    exportEmployees();
    exit();
}

// Mendapatkan data karyawan
$employees = [];
$result = $conn->query("SELECT * FROM employees");
while ($row = $result->fetch_assoc()) {
    $employees[] = $row;
}
?>

<!DOCTYPE html>
<html lang="id-ID">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT HARAPAN UTAMA PRIMA - Manajemen Karyawan</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f8f8;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #ff66b2;
            padding: 20px;
            text-align: center;
            color: white;
        }
        .container {
            width: 80%;
            margin: 20px auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #ff66b2;
            color: white;
        }
        .btn {
            background-color: #ff66b2;
            color: white;
            padding: 8px 12px;
            border: none;
           
::contentReference[oaicite:0]{index=0}
 
